<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview • envClean</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview">
<meta property="og:description" content="envClean">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">envClean</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/010_overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/020_clean.html">The full process</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Acanthiza/envClean/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="010_overview_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview</h1>
                        <h4 class="author">Department for Environment and Water</h4>
                        <h4 class="author">Nigel Willoughby</h4>
            
            <h4 class="date">Thursday, 23 February, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Acanthiza/envClean/blob/master/vignettes/010_overview.Rmd"><code>vignettes/010_overview.Rmd</code></a></small>
      <div class="hidden name"><code>010_overview.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">pacs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"knitr"</span>
            , <span class="st">"envClean"</span>
            , <span class="st">"envReport"</span>
            , <span class="st">"envFunc"</span>, <span class="st">"fs"</span>, <span class="st">"purrr"</span>
            , <span class="st">"dplyr"</span>, <span class="st">"sf"</span>, <span class="st">"tibble"</span>
            , <span class="st">"tmap"</span>, <span class="st">"raster"</span>, <span class="st">"rstanarm"</span>
            <span class="op">)</span>

  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="va">pacs</span>
              , <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">.</span>
                                                        , character.only <span class="op">=</span> <span class="cn">TRUE</span>
                                                        , quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
                                                <span class="op">)</span>
              <span class="op">)</span>

  <span class="co">#  Load data</span>
  <span class="va">flor_all</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu">envClean</span><span class="fu">::</span><span class="va"><a href="../reference/flor_all.html">flor_all</a></span><span class="op">)</span>
  
  <span class="co"># What crs to use for maps?</span>
  <span class="va">use_crs</span> <span class="op">&lt;-</span> <span class="fl">3577</span> <span class="co"># actually an epsg code. see epsg.io</span>
  
  <span class="co"># set area of interest coordinate reference system</span>
  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">envClean</span><span class="fu">::</span><span class="va"><a href="../reference/aoi.html">aoi</a></span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">use_crs</span><span class="op">)</span>
  </code></pre></div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><code>envClean</code> is not on CRAN.</p>
<p>Install the development version from GitHub</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"acanthiza/envClean"</span><span class="op">)</span></code></pre></div>
<p>Load <code>envClean</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://acanthiza.github.io/envClean/">"envClean"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Suggested workflow</h2>
<p>After many, many iterations, the following workflow has been found to be ok. Only ok. There is no awesome when cleaning large, unstructured data.</p>
<table class="table">
<caption>Suggested steps in the cleaning process</caption>
<thead><tr class="header">
<th align="left">clean</th>
<th align="left">desc</th>
<th align="right">order</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">all</td>
<td align="left">starting point</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tem_range</td>
<td align="left">within a date range</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">tem_bin</td>
<td align="left">assigning dates to temporal bins</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">tem_rel</td>
<td align="left">temporal reliability</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">geo_range</td>
<td align="left">within a geographic area</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">geo_bin</td>
<td align="left">assigning locations to spatial bins</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">geo_rel</td>
<td align="left">spatial reliability</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">ann</td>
<td align="left">non-persistent taxa</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">taxa</td>
<td align="left">align taxonomy and resolve any taxonomic duplication within bins</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">single</td>
<td align="left">singletons</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">out</td>
<td align="left">outliers</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA values in important columns</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">effort</td>
<td align="left">context effort</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">prop</td>
<td align="left">proportion of sites</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">life</td>
<td align="left">as a byproduct of assigning all records of a taxa a lifeform</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">cov</td>
<td align="left">as a byproduct of assigning all records of a taxa a cover value</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">recent</td>
<td align="left">the most recent visit to a cell</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">tidy</td>
<td align="left">last check for singleton sites</td>
<td align="right">17</td>
</tr>
</tbody>
</table>
</div>
<div id="key-concepts" class="section level2">
<h2 class="hasAnchor">
<a href="#key-concepts" class="anchor"></a>Key concepts</h2>
<div id="filtercleantidy" class="section level3">
<h3 class="hasAnchor">
<a href="#filtercleantidy" class="anchor"></a>Filter/clean/tidy</h3>
<p><code>envClean</code>, helps with implementing:</p>
<ul>
<li>filtering: remove rows of a data frame. These may be entirely legitimate observations but it is desirable to remove them for the purposes of a downstream analysis. For example, a [context] with only one (legitimate) record may not meet the expectations of an analysis that within each [context] there is a list of taxa recorded.</li>
<li>cleaning: remove observations to reduce the risk that spurious observations are included in downstream analysis. For example, two different data sources may contain the same observation. Most analyses will perform better when records duplicated within a context are removed.</li>
<li>tidying: as per <a href="https://www.jstatsoft.org/article/view/v059i10">tidy data</a> <span class="citation">(Wickham 2014)</span> where each variable is a column and each observation is a unique row.</li>
</ul>
<p>In practice these tasks are often blurred within each of the functions. For example <code>filter_taxa</code> cleans taxonomic names and tidies the data set with respect to any [context] specified.</p>
<p>In general the process will be referred to as <em>cleaning</em>.</p>
</div>
<div id="sitevisitrecordtaxa" class="section level3">
<h3 class="hasAnchor">
<a href="#sitevisitrecordtaxa" class="anchor"></a>Site/visit/record/taxa</h3>
<p>Due to the loose definition of <a href="#context">context</a> (see below), the definitions of site, visit, record and taxa can change through the cleaning process.</p>
<ul>
<li>sites are spatial locations. they may be defined by latitude, longitude, easting, northing and/or cell. These may be duplicated before exclusive application of context. They are not necessarily defined by all spatial concepts within context at all stages of the cleaning process.</li>
<li>visits are sites plus a time, such as year, month, day (or, even hour). Again, until context is applied exclusively, these may be duplicated</li>
<li>records are visits plus an observation to some level of the taxonomic hierarchy (refered to simply as ‘taxa’)</li>
<li>taxa refers to some form of taxonomic entity. An entity may be duplicated within a visit before taxonomy is resolved and context is applied exclusively (usually by <code>filter_taxa</code>).</li>
</ul>
</div>
<div id="context" class="section level3">
<h3 class="hasAnchor">
<a href="#context" class="anchor"></a>Context and binning</h3>
<p>Context is usually defined by two scales of particular interest: space (location) and time. It is possible, but often not desirable, to assign other concepts to <code>context</code> too (e.g. say, data source).</p>
<p>Throughout the series of <code>env</code> packages the concept of <em>context</em> is used extensively, and at least currently, somewhat loosely. Context is also related to <code>binning</code>: lumping records into spatial and or temporal ‘bins’. Later in the cleaning process, spatial and temporal bins are likely to define the context.</p>
<p>With respect to ‘loosely’: context may be defined by, say, <code>c("lat", "long", "cell", "year", "month")</code>. At various stages through the cleaning process not every one of those variables may be applicable. After running <code>add_raster_cell</code> (to assign a spatial bin) the variable <code>lat</code> and <code>long</code> may be removed (depending on the <code>add_xy</code> argument). However <code>context</code> can still be used in full in cleaning steps (via the consistent use of <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">tidyselect::any_of</a></code> in <code>envClean</code> functions).</p>
<p>Note that <code>context</code> is only applied <em>exclusively</em> only when <code>filter_taxa</code> is run (see examples below). Thus: extraneous fields/columns beyond <code>context</code> are maintained until taxonomy is filtered (unless they are provided via the various arguments to <code>filter_taxa</code>); and no claim is made regarding the uniqueness of ‘records’ until this step in the process. Thus, if a cleaning process does not include <code>filter_taxa</code>, running, say, <code>dplyr::distinct(across(any_of(context)))</code> may be useful.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="co"># Simple context example</span>
  <span class="va">flor_example</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
     <span class="op">~</span><span class="va">data_source</span>, <span class="op">~</span><span class="va">original_name</span>, <span class="op">~</span><span class="va">location</span>, <span class="op">~</span><span class="va">year</span>,
     <span class="st">"A"</span>, <span class="st">"Eucalyptus leucoxylon"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>,
     <span class="st">"B"</span>, <span class="st">"Eucalyptus leucoxylon"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>
   <span class="op">)</span>

  <span class="va">flor_example</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   data_source original_name         location year </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;</span>
<span class="co">#&gt; 1 A           Eucalyptus leucoxylon x        y    </span>
<span class="co">#&gt; 2 B           Eucalyptus leucoxylon x        y</span>

  <span class="co"># set context </span>
  <span class="va">context</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"year"</span><span class="op">)</span>
  
  <span class="co"># filter singletons - context not applied</span>
  <span class="va">flor_single</span> <span class="op">&lt;-</span> <span class="va">flor_example</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/filter_counts.html">filter_counts</a></span><span class="op">(</span>context <span class="op">=</span> <span class="va">context</span>
                  , thresh <span class="op">=</span> <span class="fl">1</span>
                  <span class="op">)</span>
  
  <span class="co"># two rows</span>
  <span class="va">flor_single</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   data_source original_name         location year </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                 &lt;chr&gt;    &lt;chr&gt;</span>
<span class="co">#&gt; 1 A           Eucalyptus leucoxylon x        y    </span>
<span class="co">#&gt; 2 B           Eucalyptus leucoxylon x        y</span>
      
  <span class="co"># filter taxa - context applied exclusively</span>
  <span class="va">flor_taxa</span> <span class="op">&lt;-</span> <span class="va">flor_example</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/filter_taxa.html">filter_taxa</a></span><span class="op">(</span>context <span class="op">=</span> <span class="va">context</span>
                , king_type <span class="op">=</span> <span class="st">"Plantae"</span>
                <span class="op">)</span>
<span class="co">#&gt; [1] "1 of 1 (100%): Eucalyptus leucoxylon"</span>
  
  <span class="co"># one row</span>
  <span class="va">flor_taxa</span>
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   location year  taxa                 </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;                </span>
<span class="co">#&gt; 1 x        y     Eucalyptus leucoxylon</span></code></pre></div>
</div>
<div id="naming" class="section level3">
<h3 class="hasAnchor">
<a href="#naming" class="anchor"></a>Naming</h3>
<p>By careful use of naming when creating objects during the cleaning process it is possible to create automated summaries of the process. See the <a href="#workflow">workflow</a> section for suggested names for steps in the cleaning process. Within this vignette, the prefix <code>flor_</code> has been added and the function <code>add_time_stamp()</code> has been used to assist ordering the cleaning process <a href="#summary">summary</a>.</p>
</div>
<div id="coordinate-reference-systems" class="section level3">
<h3 class="hasAnchor">
<a href="#coordinate-reference-systems" class="anchor"></a>Coordinate reference systems</h3>
<p>There are two (possibly three) main coordinate reference systems (crs) to worry about:</p>
<ol style="list-style-type: decimal">
<li>the crs for the original records. If these are in decimal degrees, using <a href="https://epsg.io/">epsg</a> = <a href="https://epsg.io/4283">4283</a> is likely to return the correct crs.</li>
<li>the crs you’d like to use for most spatial data. Set here (in setup chunk) to <code>use_crs</code> = 3577. It is likely that a projected crs will work best, particularly for buffering, filtering etc.</li>
<li>the crs for any other spatial data imported to help with cleaning. Try using <code>sf::st_read("random_shape_file.shp") %&gt;% sf::st_tranform(crs = use_crs)</code> to deal with this.</li>
</ol>
</div>
</div>
<div id="import" class="section level2">
<h2 class="hasAnchor">
<a href="#import" class="anchor"></a>Import</h2>
<p>Querying and uniting disparate data sources into a single data set is a challenge in its own right. See <a href="https://github.com/Acanthiza/envImport">envImport</a> for tools to assist there. Once you’ve imported and combined all your data, read on.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-JSSv059i10">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nigel Willoughby.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
