<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>envClean • envClean</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="envClean">
<meta property="og:description" content="envClean">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">envClean</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/envClean.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Acanthiza/envClean/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="envClean_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>envClean</h1>
                        <h4 class="author">Department for Environment and Water</h4>
                        <h4 class="author">Nigel Willoughby</h4>
            
            <h4 class="date">Tuesday, 02 November, 2021. 10:37</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Acanthiza/envClean/blob/master/vignettes/envClean.Rmd"><code>vignettes/envClean.Rmd</code></a></small>
      <div class="hidden name"><code>envClean.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'knitr' was built under R version 4.0.5</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Acanthiza/envClean">envClean</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Acanthiza/envReport">envReport</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Acanthiza/envFunc">envFunc</a></span><span class="op">)</span> <span class="co"># needed for add_raster_cell</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://fs.r-lib.org">fs</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'fs' was built under R version 4.0.5</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'purrr' was built under R version 4.0.5</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'sf' was built under R version 4.0.5</span>
<span class="co">#&gt; Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'tibble' was built under R version 4.0.5</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'tmap' was built under R version 4.0.5</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'raster' was built under R version 4.0.5</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; Warning: package 'sp' was built under R version 4.0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'raster'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     select</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'rstanarm' was built under R version 4.0.5</span>
<span class="co">#&gt; Loading required package: Rcpp</span>
<span class="co">#&gt; Warning: package 'Rcpp' was built under R version 4.0.5</span>
<span class="co">#&gt; This is rstanarm version 2.21.1</span>
<span class="co">#&gt; - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</span>
<span class="co">#&gt; - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</span>
<span class="co">#&gt; - For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="co">#&gt;   options(mc.cores = parallel::detectCores())</span>

  <span class="fu"><a href="https://rdrr.io/pkg/envReport/man/fix_bib.html">fix_bib</a></span><span class="op">(</span>bib_file <span class="op">=</span> <span class="st">"vignettes/packages.bib"</span><span class="op">)</span>
<span class="co">#&gt; Warning: `as_data_frame()` was deprecated in tibble 2.0.0.</span>
<span class="co">#&gt; Please use `as_tibble()` instead.</span>
<span class="co">#&gt; The signature and semantics have changed, see `?as_tibble`.</span>
<span class="co">#&gt; # A tibble: 13 x 28</span>
<span class="co">#&gt;    CATEGORY BIBTEXKEY  ADDRESS  ANNOTE AUTHOR BOOKTITLE CHAPTER CROSSREF EDITION</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;list&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  </span>
<span class="co">#&gt;  1 MANUAL   R-base     Vienna,~ &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  2 MANUAL   R-envClean &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  3 MANUAL   R-envFunc  &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  4 MANUAL   R-envRepo~ &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  5 MANUAL   R-raster   &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  6 MANUAL   R-sf       &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  7 MANUAL   R-sp       &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  8 MANUAL   R-tibble   &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt;  9 MANUAL   R-tmap     &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt; 10 ARTICLE  sf2018     &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt; 11 ARTICLE  sp2005     &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt; 12 BOOK     sp2013     &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt; 13 ARTICLE  tmap2018   &lt;NA&gt;     &lt;NA&gt;   &lt;chr ~ &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;     &lt;NA&gt;   </span>
<span class="co">#&gt; # ... with 19 more variables: EDITOR &lt;list&gt;, HOWPUBLISHED &lt;chr&gt;,</span>
<span class="co">#&gt; #   INSTITUTION &lt;chr&gt;, JOURNAL &lt;chr&gt;, KEY &lt;chr&gt;, MONTH &lt;chr&gt;, NOTE &lt;chr&gt;,</span>
<span class="co">#&gt; #   NUMBER &lt;chr&gt;, ORGANIZATION &lt;chr&gt;, PAGES &lt;chr&gt;, PUBLISHER &lt;chr&gt;,</span>
<span class="co">#&gt; #   SCHOOL &lt;chr&gt;, SERIES &lt;chr&gt;, TITLE &lt;chr&gt;, TYPE &lt;chr&gt;, VOLUME &lt;chr&gt;,</span>
<span class="co">#&gt; #   YEAR &lt;chr&gt;, URL &lt;chr&gt;, DOI &lt;chr&gt;</span>

  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span>
<span class="co">#&gt; tmap mode set to plotting</span>

  <span class="va">flor_all</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">flor_all</span><span class="op">)</span>
  
  <span class="co"># What crs to use for maps?</span>
  <span class="va">use_crs</span> <span class="op">&lt;-</span> <span class="fl">3577</span> <span class="co"># actually an epsg code. see epsg.io</span>
  
  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="va">aoi</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">use_crs</span><span class="op">)</span>
  </code></pre></div>
<div id="get-envclean" class="section level2">
<h2 class="hasAnchor">
<a href="#get-envclean" class="anchor"></a>Get <code>envClean</code>
</h2>
<p><code>envClean</code> is not on CRAN.</p>
<p>Install the development version from GitHub</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"acanthiza/envClean"</span><span class="op">)</span></code></pre></div>
<p>Load <code>envClean</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/Acanthiza/envClean">"envClean"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="suggested-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#suggested-workflow" class="anchor"></a>Suggested workflow</h2>
<p>After many, many iterations, the following workflow has been found to be ok. Only ok. There is no awesome when cleaning large, unstructured data.</p>
<div id="import" class="section level3">
<h3 class="hasAnchor">
<a href="#import" class="anchor"></a>Import</h3>
<p>Querying and uniting disparate data sources into a single data set is a challenge in its own right. See <code>envImport</code> for tools to assist there. Once you’ve imported and combined all your data, read on.</p>
<p>Here, we’ll start with combined floristic data (called <code>flor_all</code>) from the mallee in South Australia. This data set is provided with <code>envClean</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_all</span>
<span class="co">#&gt; # A tibble: 13,104 x 13</span>
<span class="co">#&gt;      lat  long data_name site   date       original_name cover cover_code quad_x</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -34.5  140. BCM       -2110~ 2013-01-23 Eucalyptus p~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  2 -34.5  140. BCM       -2110~ 2013-01-23 Triodia irri~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  3 -34.5  140. BCM       -2110~ 2013-01-23 Carpobrotus ~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  4 -34.5  140. BCM       -2110~ 2013-01-23 Geijera line~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  5 -34.5  140. BCM       -2110~ 2013-01-23 Sclerolaena ~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  6 -34.5  140. BCM       -2110~ 2013-01-23 Eucalyptus o~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  7 -34.5  140. BCM       -2110~ 2013-01-23 Sisymbrium i~    NA &lt;NA&gt;           20</span>
<span class="co">#&gt;  8 -34.5  140. BCM       -5177~ 2006-09-10 Olearia pime~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  9 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus o~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; 10 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus g~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; # ... with 13,094 more rows, and 4 more variables: quad_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   rel_dist &lt;dbl&gt;, month &lt;dbl&gt;, year &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="note-on-coordinate-reference-systems" class="section level3">
<h3 class="hasAnchor">
<a href="#note-on-coordinate-reference-systems" class="anchor"></a>Note on coordinate reference systems</h3>
<p>There are two (possibly three) main coordinate reference systems (crs) to worry about:</p>
<ol style="list-style-type: decimal">
<li>the crs for the original records. If these are in decimal degrees, using <a href="https://epsg.io/">epsg</a> = <a href="https://epsg.io/4283">4283</a> is likely to return the correct crs.</li>
<li>the crs you’d like to use for most spatial data. Set here (in setup chunk) to <code>use_crs</code> = 3577. It is likely that a projected crs will work best, particularly for buffering, filtering etc.</li>
<li>the crs for any other spatial data imported to help with cleaning. Try using <code>sf::st_read("random_shape_file.shp") %&gt;% sf::st_tranform(crs = use_crs)</code> to deal with this.</li>
</ol>
</div>
<div id="area-of-interest" class="section level3">
<h3 class="hasAnchor">
<a href="#area-of-interest" class="anchor"></a>Area of interest</h3>
<p>Usually this is a geographic and/or taxonomic area of interest. An example area overlapping <code>flor_all</code> is provided in <code>aoi</code>. Converting <code>flor_all</code> to <code>sf</code> allows plotting them together.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_all_sf</span> <span class="op">&lt;-</span> <span class="va">flor_all</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>
                 , crs <span class="op">=</span> <span class="fl">4326</span>
                 <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">aoi</span>
           , bbox <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">flor_all_sf</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">flor_all_sf</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="envClean_files/figure-html/aoi-1.png" width="700"></p>
<p>Filtering <code>flor_all</code> to <code>aoi</code> is done with <code>filter_aoi</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_aoi.html">filter_aoi</a></span><span class="op">(</span><span class="va">flor_all</span>
                         , use_aoi <span class="op">=</span> <span class="va">aoi</span>
                         , crs_aoi <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span>
                         <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_time_stamp.html">add_time_stamp</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("lat", "long")</span>

  <span class="va">flor_aoi</span>
<span class="co">#&gt; # A tibble: 3,485 x 13</span>
<span class="co">#&gt;      lat  long data_name site   date       original_name cover cover_code quad_x</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -34.5  140. BCM       -5177~ 2006-09-10 Olearia pime~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  2 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus o~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  3 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus g~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  4 -34.5  140. BCM       -5177~ 2006-09-10 Maireana tri~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  5 -34.5  140. BCM       -5177~ 2006-09-10 Maireana pen~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  6 -34.5  140. BCM       -5177~ 2006-09-10 Santalum mur~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  7 -34.5  140. BCM       -5177~ 2006-09-10 Rhagodia cra~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  8 -34.5  140. BCM       -5177~ 2006-09-10 Eremophila g~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  9 -34.5  140. BCM       -5177~ 2006-09-10 Geijera line~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; 10 -34.5  140. BCM       -5177~ 2006-09-10 Maireana eri~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; # ... with 3,475 more rows, and 4 more variables: quad_y &lt;dbl&gt;, rel_dist &lt;dbl&gt;,</span>
<span class="co">#&gt; #   month &lt;dbl&gt;, year &lt;dbl&gt;</span></code></pre></div>
<p>Check that spatial filter worked.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_aoi_sf</span> <span class="op">&lt;-</span> <span class="va">flor_aoi</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>
                 , crs <span class="op">=</span> <span class="fl">4326</span>
                 <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">aoi</span>
           , bbox <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">flor_all_sf</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">flor_aoi_sf</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="envClean_files/figure-html/flor_aoi-1.png" width="700"></p>
</div>
</div>
<div id="context" class="section level2">
<h2 class="hasAnchor">
<a href="#context" class="anchor"></a>Context: scales of interest</h2>
<p>There are two scales of particular interest: space (location) and time. Together these are used to set the <code>context</code> throughout filtering and analysis. It is possible to assign other concepts to <code>context</code> too (e.g. say, data source). Note that <code>context</code> is first applied <em>exclusively</em> only when taxonomy is filtered. For example, if sppA has a record at location x and time y from different data sources (see table below) these will only be reduced to a single ‘record’ when taxonomy is filtered. Another way to say this: extraneous fields/columns beyond <code>context</code> are maintained until taxonomy is filtered. However, even at that point, extra columns can be specified (see <a href="#filter-taxonomy">Filter taxonomy</a>).</p>
<p>The original location columns probably suggest metre accuracy, or even sub-metre. There may also be a field dampening expectations of such accuracy with estimates of precision for the location. In the following workflow, a precision threshold is set and then an accuracy threshold is adopted. All records with worse precision than threshold are removed, and then all records within the accuracy threshold are lumped. The lumping is done via a raster placed over the <code>aoi</code>.</p>
<p>The original time scale probably suggests accuracy to day, or perhaps even hour, or sub-hour. Choose a scale of relevance to your question. In the example below month is used. Thus all data recorded within a spatial location within a month are treated as one ‘visit’. A ‘taxa’ within a ‘visit’ is considered a ‘record’.</p>
<table class="table">
<caption>Context example</caption>
<thead><tr class="header">
<th align="left">data_source</th>
<th align="left">taxa</th>
<th align="left">location</th>
<th align="left">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">sppA</td>
<td align="left">x</td>
<td align="left">y</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">sppA</td>
<td align="left">x</td>
<td align="left">y</td>
</tr>
</tbody>
</table>
<div id="precision" class="section level3">
<h3 class="hasAnchor">
<a href="#precision" class="anchor"></a>Precision</h3>
<p>Records with precision less than threshold are filtered using <code>filter_spat_rel</code>. This takes a dataframe (<code>df</code>) as its first argument, in this case <code>flor_aoi</code>. <code>dist_col</code> specifies the column in <code>df</code> that contains the precision estimates. <code>dist</code> provides the threshold above which to filter. If there are data sources (or any other columns in <code>df</code>) that do not include an estimate of spatial precision, but you would like to keep, this can be done with the argument <code>over_ride</code>. This takes a named list, where names need to match the columns in <code>df</code>. Any levels within the columns provided in <code>over_ride</code> will not be filtered, irrespective of the values in <code>dist_col</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">context</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"lat"</span>, <span class="st">"long"</span>, <span class="st">"cell"</span><span class="op">)</span>

  <span class="va">include_data_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ALIS"</span>,<span class="st">"BCM"</span>,<span class="st">"NVB"</span>,<span class="st">"TERN"</span><span class="op">)</span>

  <span class="va">flor_rel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_spat_rel.html">filter_spat_rel</a></span><span class="op">(</span><span class="va">flor_aoi</span>
                              , dist_col <span class="op">=</span> <span class="st">"rel_dist"</span>
                              , dist <span class="op">=</span> <span class="fl">100</span>
                              , context <span class="op">=</span> <span class="va">context</span>
                              , over_ride <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data_name <span class="op">=</span> <span class="va">include_data_name</span><span class="op">)</span>
                              <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_time_stamp.html">add_time_stamp</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("lat", "long", "month", "year")</span>
  
  <span class="va">flor_rel</span>
<span class="co">#&gt; # A tibble: 2,332 x 13</span>
<span class="co">#&gt;      lat  long data_name site   date       original_name cover cover_code quad_x</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -34.5  140. BCM       -5177~ 2006-09-10 Olearia pime~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  2 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus o~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  3 -34.5  140. BCM       -5177~ 2006-09-10 Eucalyptus g~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  4 -34.5  140. BCM       -5177~ 2006-09-10 Maireana tri~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  5 -34.5  140. BCM       -5177~ 2006-09-10 Maireana pen~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  6 -34.5  140. BCM       -5177~ 2006-09-10 Santalum mur~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  7 -34.5  140. BCM       -5177~ 2006-09-10 Rhagodia cra~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  8 -34.5  140. BCM       -5177~ 2006-09-10 Eremophila g~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt;  9 -34.5  140. BCM       -5177~ 2006-09-10 Geijera line~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; 10 -34.5  140. BCM       -5177~ 2006-09-10 Maireana eri~    NA &lt;NA&gt;           30</span>
<span class="co">#&gt; # ... with 2,322 more rows, and 4 more variables: quad_y &lt;dbl&gt;, rel_dist &lt;dbl&gt;,</span>
<span class="co">#&gt; #   month &lt;dbl&gt;, year &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="rasterize" class="section level3">
<h3 class="hasAnchor">
<a href="#rasterize" class="anchor"></a>Rasterize</h3>
<p>Now that records with dubious spatial precision have been removed, an accuracy threshold is adpoted by rasterizing remaining records into the cells of <code>aoi_raster</code>, created here.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">aoi_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span>
                      , resolution <span class="op">=</span> <span class="fl">30</span>
                      , crs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"+init=epsg:"</span>,<span class="va">use_crs</span><span class="op">)</span><span class="op">)</span>
                      <span class="op">)</span>
<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj</span>
<span class="co">#&gt; = prefer_proj): Discarded datum Geocentric_Datum_of_Australia_1994 in Proj4</span>
<span class="co">#&gt; definition</span>

  <span class="va">aoi_raster</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 367, 300, 110100  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 30, 30  (x, y)</span>
<span class="co">#&gt; extent     : 723000, 732000, -3800010, -3789000  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=aea +lat_0=0 +lon_0=132 +lat_1=-18 +lat_2=-36 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></code></pre></div>
<p>Rasterizing the current data is then done via <code>add_raster_cell</code>. This function has the argument <code>add_xy</code> which will add the centroid of the cell back to the data frame using the same names as the original <code>x</code> and <code>y</code> columns. Alternatively, the <code>x</code> and <code>y</code> columns will be lost from the returned data frame, replaced with <code>cell</code>, the raster cell id.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_raster_cell.html">add_raster_cell</a></span><span class="op">(</span><span class="va">aoi_raster</span>
                               , <span class="va">flor_rel</span>
                               , add_xy <span class="op">=</span> <span class="cn">TRUE</span>
                               , crs_df <span class="op">=</span> <span class="fl">4283</span>
                               <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_time_stamp.html">add_time_stamp</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("old_y", "old_x")</span>

  <span class="va">flor_cell</span>
<span class="co">#&gt; # A tibble: 2,330 x 14</span>
<span class="co">#&gt;     cell  long   lat data_name site   date       original_name  cover cover_code</span>
<span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt;  1  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Westringia ri~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  2  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Maireana tric~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  3  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Maireana pent~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  4  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Olearia muell~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  5  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Geijera linea~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  6  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Halgania andr~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  7  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Rhagodia cras~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  8  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Ptilotus semi~    NA &lt;NA&gt;      </span>
<span class="co">#&gt;  9  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Austrostipa a~    NA &lt;NA&gt;      </span>
<span class="co">#&gt; 10  7040  140. -34.5 EGIS      SUP29~ 2006-10-18 Eucalyptus gr~    NA &lt;NA&gt;      </span>
<span class="co">#&gt; # ... with 2,320 more rows, and 5 more variables: quad_x &lt;dbl&gt;, quad_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   rel_dist &lt;dbl&gt;, month &lt;dbl&gt;, year &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="taxonomy" class="section level2">
<h2 class="hasAnchor">
<a href="#taxonomy" class="anchor"></a>Taxonomy</h2>
<div id="make-taxonomy" class="section level3">
<h3 class="hasAnchor">
<a href="#make-taxonomy" class="anchor"></a>Make taxonomy</h3>
<p>Historically, reconciling taxonomy has been by far the most time-consuming, and necessarily expert-driven part of cleaning biological data from any unstructured data set(s). In the past it was often necessary to get an expert botanist to generate an analysis specific taxonomy, taking into account such things as the area of interest, timing (e.g. decade (was it a wet decade), season (was the timing right for orchids or not?)) of the of the main previous surveys, and even possibly the expertise-at-survey-time of the observers. Nothing will replace the quality of the results from such a process. Using online taxonomic tools such as the <a href="https://www.gbif.org/dataset/d7dddbf4-2cf0-4f39-9b2a-bb099caae36c">GBIF taxonomy backbone</a> provides an automated alternative that comes with an unquantified (but unlikely to be negligible) penalty in quality. However, the enormous benefit in flexibility and time provided by automated tools makes them essential in practice.</p>
<p>Reconciling taxonomy can be done with the <code>make_taxa_taxonomy</code> function. This creates two objects that are loaded to the global environment:</p>
<ul>
<li>
<code>lutaxa.</code> This is a simple lookup from the original name provided to the taxa to use in place of that name. Thus, <code>taxa</code> is likely to be duplicated</li>
<li>
<code>taxa_taxonomy</code> provides the full taxonomic hierarchy for each <code>taxa</code> in the <code>lutaxa</code> object. The column <code>taxa</code> should not have any duplicates. The output can also include lifespan and indigenous status columns, if they are available from any of the original data sources and they are provided to <code>make_taxa_taxonomy</code>.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="fu"><a href="../reference/make_taxa_taxonomy.html">make_taxa_taxonomy</a></span><span class="op">(</span><span class="va">flor_cell</span>
                     , save_luGBIF <span class="op">=</span> <span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span><span class="op">(</span><span class="st">"vignettes"</span>,<span class="st">"luGBIF.feather"</span><span class="op">)</span>
                     <span class="op">)</span>
<span class="co">#&gt; Loading required namespace: feather</span>
<span class="co">#&gt; Joining, by = "original_name"</span>
<span class="co">#&gt; Joining, by = c("taxa", "kingdom", "phylum", "order", "family", "genus", "species", "class")</span></code></pre></div>
<p><code>lutaxa</code> is returned to the global environment.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">lutaxa</span>
<span class="co">#&gt; # A tibble: 352 x 3</span>
<span class="co">#&gt;    original_name                             taxa                   rank      </span>
<span class="co">#&gt;    &lt;chr&gt;                                     &lt;chr&gt;                  &lt;ord&gt;     </span>
<span class="co">#&gt;  1 Zygophyllum aurantiacum (NC)              Roepera aurantiaca     subspecies</span>
<span class="co">#&gt;  2 Westringia rigida                         Westringia rigida      species   </span>
<span class="co">#&gt;  3 Westringia rigida R.Br.                   Westringia rigida      species   </span>
<span class="co">#&gt;  4 Wahlenbergia luteola                      Wahlenbergia luteola   species   </span>
<span class="co">#&gt;  5 Wahlenbergia luteola P.J.Sm.              Wahlenbergia luteola   species   </span>
<span class="co">#&gt;  6 Vulpia myuros f. myuros                   Vulpia myuros          species   </span>
<span class="co">#&gt;  7 Vulpia muralis                            Vulpia muralis         species   </span>
<span class="co">#&gt;  8 Vulpia muralis (Kunth) Nees               Vulpia muralis         species   </span>
<span class="co">#&gt;  9 Vittadinia megacephala                    Vittadinia megacephala species   </span>
<span class="co">#&gt; 10 Vittadinia megacephala (Benth.) J.M.Black Vittadinia megacephala species   </span>
<span class="co">#&gt; # ... with 342 more rows</span></code></pre></div>
<p>as is <code>taxa_taxonomy</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">taxa_taxonomy</span>
<span class="co">#&gt; # A tibble: 195 x 8</span>
<span class="co">#&gt;    taxa                    kingdom phylum  order  family  genus  species   class</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;</span>
<span class="co">#&gt;  1 Roepera aurantiaca      Plantae Trache~ Zygop~ Zygoph~ Roepe~ Roepera ~ Magn~</span>
<span class="co">#&gt;  2 Westringia rigida       Plantae Trache~ Lamia~ Lamiac~ Westr~ Westring~ Magn~</span>
<span class="co">#&gt;  3 Wahlenbergia luteola    Plantae Trache~ Aster~ Campan~ Wahle~ Wahlenbe~ Magn~</span>
<span class="co">#&gt;  4 Vulpia myuros           Plantae Trache~ Poales Poaceae Vulpia Vulpia m~ Lili~</span>
<span class="co">#&gt;  5 Vulpia muralis          Plantae Trache~ Poales Poaceae Vulpia Vulpia m~ Lili~</span>
<span class="co">#&gt;  6 Vittadinia megacephala  Plantae Trache~ Aster~ Astera~ Vitta~ Vittadin~ Magn~</span>
<span class="co">#&gt;  7 Vittadinia gracilis     Plantae Trache~ Aster~ Astera~ Vitta~ Vittadin~ Magn~</span>
<span class="co">#&gt;  8 Vittadinia dissecta     Plantae Trache~ Aster~ Astera~ Vitta~ Vittadin~ Magn~</span>
<span class="co">#&gt;  9 Vittadinia cuneata      Plantae Trache~ Aster~ Astera~ Vitta~ Vittadin~ Magn~</span>
<span class="co">#&gt; 10 Vittadinia cervicularis Plantae Trache~ Aster~ Astera~ Vitta~ Vittadin~ Magn~</span>
<span class="co">#&gt; # ... with 185 more rows</span></code></pre></div>
</div>
<div id="filter-taxonomy" class="section level3">
<h3 class="hasAnchor">
<a href="#filter-taxonomy" class="anchor"></a>Filter taxonomy</h3>
<p>Cleaning to a single taxonomy is now possible sing <code>lutaxa</code> and <code>taxa_taxonomy</code>. At this point, the <a href="#context">context</a> is also <em>exclusively</em> applied. Thus the output of applying <code>filter_taxa</code> is to generate a single record for each taxa within each context, with a single field-based result for any <code>extra_cols</code> provided to <code>filter_taxa</code>. Likewise, by providing <code>do_cov</code> and <code>lucov</code> to <code>filter_taxa</code>, a single, field-based estimate of cover is generated for each ‘record’.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">flor_taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_taxa.html">filter_taxa</a></span><span class="op">(</span><span class="va">flor_cell</span>
                          , taxa_col <span class="op">=</span> <span class="st">"original_name"</span>
                          , context <span class="op">=</span> <span class="va">context</span>
                          , do_cov <span class="op">=</span> <span class="cn">TRUE</span>
                          , lucov <span class="op">=</span> <span class="fu">envEcosystems</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/envEcosystems/man/lucover.html">lucover</a></span>
                          <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_time_stamp.html">add_time_stamp</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "original_name"</span>
<span class="co">#&gt; Joining, by = "taxa"</span>
<span class="co">#&gt; Joining, by = "original_name"</span>
<span class="co">#&gt; Joining, by = "cover_code"</span>
<span class="co">#&gt; Joining, by = c("year", "month", "lat", "long", "cell", "taxa")</span>

  <span class="va">flor_taxa</span>
<span class="co">#&gt; # A tibble: 860 x 7</span>
<span class="co">#&gt;     year month   lat  long  cell taxa              use_cover</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2006    10 -34.5  140.  7040 Westringia rigida     0.015</span>
<span class="co">#&gt;  2  2006    10 -34.5  140. 12659 Westringia rigida     0.01 </span>
<span class="co">#&gt;  3  1990     5 -34.5  140. 18098 Westringia rigida     0.015</span>
<span class="co">#&gt;  4  1990     5 -34.5  140. 18722 Westringia rigida     0.015</span>
<span class="co">#&gt;  5  1990     5 -34.5  140. 19039 Westringia rigida     0.015</span>
<span class="co">#&gt;  6  2006    10 -34.5  140. 19307 Westringia rigida     0.01 </span>
<span class="co">#&gt;  7  1990     6 -34.5  140. 34485 Westringia rigida     0.015</span>
<span class="co">#&gt;  8  2006    10 -34.5  140. 37110 Westringia rigida     0.015</span>
<span class="co">#&gt;  9  1990     4 -34.5  140. 37110 Westringia rigida     0.015</span>
<span class="co">#&gt; 10  1990     4 -34.5  140. 39212 Westringia rigida     0.015</span>
<span class="co">#&gt; # ... with 850 more rows</span></code></pre></div>
</div>
</div>
<div id="singletons" class="section level2">
<h2 class="hasAnchor">
<a href="#singletons" class="anchor"></a>Singletons</h2>
<p>An implicit assumption in collation of data sources is usually that records were a list of taxa collected at a specific spatial location (and date). In many cases this assumption proves incorrect. For example, records may be related to, say, tree health monitoring where no other taxa were concurrently recorded.</p>
<p>Thus, filtering ‘singleton’ sites (a site with only a single taxa was recorded) is often prudent.</p>
<p>This will also inadvertently filter legitimate single taxa lists. For example, some areas of samphire or mangroves may have only a single taxa recorded within a survey site. As always, it depends on the goal of any particular analysis whether this trade-off will be worthwhile.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">  
  <span class="va">flor_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_counts.html">filter_counts</a></span><span class="op">(</span><span class="va">flor_taxa</span>
                              , context <span class="op">=</span> <span class="va">context</span>
                              , thresh <span class="op">=</span> <span class="fl">1</span>
                              <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/envFunc/man/add_time_stamp.html">add_time_stamp</a></span><span class="op">(</span><span class="op">)</span>

  <span class="va">flor_single</span>
<span class="co">#&gt; # A tibble: 853 x 7</span>
<span class="co">#&gt;     year month   lat  long  cell taxa              use_cover</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2006    10 -34.5  140.  7040 Westringia rigida     0.015</span>
<span class="co">#&gt;  2  2006    10 -34.5  140. 12659 Westringia rigida     0.01 </span>
<span class="co">#&gt;  3  1990     5 -34.5  140. 18098 Westringia rigida     0.015</span>
<span class="co">#&gt;  4  1990     5 -34.5  140. 18722 Westringia rigida     0.015</span>
<span class="co">#&gt;  5  1990     5 -34.5  140. 19039 Westringia rigida     0.015</span>
<span class="co">#&gt;  6  2006    10 -34.5  140. 19307 Westringia rigida     0.01 </span>
<span class="co">#&gt;  7  1990     6 -34.5  140. 34485 Westringia rigida     0.015</span>
<span class="co">#&gt;  8  2006    10 -34.5  140. 37110 Westringia rigida     0.015</span>
<span class="co">#&gt;  9  1990     4 -34.5  140. 37110 Westringia rigida     0.015</span>
<span class="co">#&gt; 10  1990     4 -34.5  140. 39212 Westringia rigida     0.015</span>
<span class="co">#&gt; # ... with 843 more rows</span></code></pre></div>
</div>
<div id="effort" class="section level2">
<h2 class="hasAnchor">
<a href="#effort" class="anchor"></a>Effort</h2>
<p>Aggregated data sets are likely to contain records of taxa at spatial locations collected by almost any method imaginable. The effort any observer(s) put into time and taxonomy at each spatial location is usually unknown.</p>
<p>Given that effort matters when documenting ecology <span class="citation">(e.g. Wiens 1989)</span>, filtering ‘effort’ is an attempt to remove the most seriously under- and over-sampled contexts.</p>
<p>Examples of low taxa richness contexts that may occur in large, unstructured data sets:</p>
<ul>
<li>brief, opportune records</li>
<li>tree-health monitoring data</li>
</ul>
<p>Examples of high taxa richness contexts that may occur in large, unstructured data sets:</p>
<ul>
<li>an observer wandering widely from the location they recorded, particularly if crossing an ecotone</li>
<li>several observers working together</li>
<li>an observer with well above average botanical knowledge</li>
<li>observations taken over a long time-frame but recorded on a single day</li>
</ul>
<p>These examples just scratch the surface of the ways in which taxa richness can deviate from that expected from an average effort by an average observer.</p>
<p>Taxa richness can be modelled as a function of any variables of interest, for example:</p>
<ul>
<li>nothing. This option might be useful in relatively small areas where the non-biological drivers of biological change are relatively stable</li>
<li>a continuous variable of interest. Say, annual mean temperature, or, soil ph</li>
<li>principal components. This option is best suited to analyses accompanied by many variables all of which are drivers, or closely correlated with, biological change</li>
<li>a categorical variable of interest. Say, <a href="https://www.awe.gov.au/agriculture-land/land/nrs/science/ibra">IBRA</a> Subregions</li>
</ul>
<p>Effort is filtered using the <code>filter_effort</code> function. This models taxa richness using a Bayesian generalised linear model implemented by the <code>rstan_glm</code> function in the <code>rstanarm</code> [<span class="citation">(<span class="citeproc-not-found" data-reference-id="R-rstanarm"><strong>???</strong></span>)</span>] package. The model is used to predict upper and lower bounds for taxa richness. Any cell with taxa richness outside those bounds can be removed, by setting the acceptable lower and upper percentiles.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="co"># effort_mod &lt;- make_effort_mod(flor_single</span>
  <span class="co">#                               , context = context</span>
  <span class="co">#                               )</span>
  <span class="co"># </span>
  <span class="co"># flor_effort &lt;- flor_single %&gt;%</span>
  <span class="co">#   dplyr::inner_join(effort_mod$mod_cell_result %&gt;%</span>
  <span class="co">#                       dplyr::filter(keep)</span>
  <span class="co">#                     )</span>
  <span class="co"># </span>
  <span class="co"># flor_effort</span></code></pre></div>
</div>
<div id="filtering-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-summary" class="anchor"></a>Filtering summary</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">  
  <span class="va">filt_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"flor_"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"combine|all|wide|sf"</span>, <span class="va">.</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">enframe</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, value <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">name</span>,<span class="va">get</span><span class="op">)</span>
                  , has_stamp <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">obj</span>,<span class="op">~</span><span class="st">"ctime"</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                  <span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">has_stamp</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">obj</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ctime <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">obj</span>,<span class="va">attr</span>,<span class="st">"ctime"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ctime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span>,<span class="va">ctime</span><span class="op">)</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-RN2377">
<p>Wiens, J A. 1989. “Spatial scaling in ecology.” Journal Article. <em>Functional Ecology</em> 3 (4): 385–97.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nigel Willoughby.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
